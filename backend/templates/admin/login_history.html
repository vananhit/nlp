{% extends "admin/layout.html" %}

{% block title %}Login History{% endblock %}

{% block head %}
<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4">Admin Login History</h1>

    <!-- Filter Form -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h6 class="m-0 font-weight-bold text-primary"><i class="fa-solid fa-filter me-2"></i>Bộ lọc</h6>
        </div>
        <div class="card-body">
            <form method="get" action="{{ url_for('view_login_history') }}">
                <div class="row align-items-end g-3">
                    <div class="col-md-4">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" value="{{ filters.username or '' }}" placeholder="Nhập username...">
                    </div>
                    <div class="col-md-3">
                        <label for="start_date" class="form-label">Từ ngày</label>
                        <input type="date" class="form-control" id="start_date" name="start_date" value="{{ filters.start_date or '' }}">
                    </div>
                    <div class="col-md-3">
                        <label for="end_date" class="form-label">Đến ngày</label>
                        <input type="date" class="form-control" id="end_date" name="end_date" value="{{ filters.end_date or '' }}">
                    </div>
                    <div class="col-md-2 d-flex">
                        <button type="submit" class="btn btn-primary w-100 me-2">Lọc</button>
                        <a href="{{ url_for('view_login_history') }}" class="btn btn-outline-secondary w-100">Xóa</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Data Table -->
    <div class="card shadow-sm">
        <div class="card-header">
            <h6 class="m-0 font-weight-bold text-primary"><i class="fa-solid fa-list me-2"></i>Kết quả</h6>
        </div>
        <div class="card-body">
            <table id="loginHistoryTable" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>Timestamp (VN Time)</th>
                        <th>Username</th>
                        <th>IP Address</th>
                        <th>OS</th>
                        <th>Browser</th>
                        <th>User Agent</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in history %}
                    <tr>
                        <td>{{ item.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        <td>{{ item.username }}</td>
                        <td>{{ item.ip_address }}</td>
                        <td>{{ item.os }} {{ item.os_version }}</td>
                        <td>{{ item.browser }} {{ item.browser_version }}</td>
                        <td>{{ item.user_agent }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
<script>
$(document).ready(function() {
    $('#loginHistoryTable').DataTable({
        "order": [[ 0, "desc" ]],
        "language": {
            "url": "//cdn.datatables.net/plug-ins/1.13.7/i18n/vi.json"
        }
    });
});
</script>
{% endblock %}
